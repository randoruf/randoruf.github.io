<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡å­æ³¢åŠ¨ä½“å½©ç”Ÿæˆå™¨</title>
    <style>
        :root {
            --primary-color: #0056b3;
            --secondary-color: #f8f9fa;
            --accent-color: #ffc107;
            --text-dark: #333;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            color: var-text-dark;
        }

        .container {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 500px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        h1 {
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .subtitle {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 1.5rem;
        }

        /* çŠ¶æ€æ æ ·å¼ */
        #status-box {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-bottom: 20px;
            border-left: 5px solid #ccc;
            text-align: left;
            word-break: break-all;
        }

        #status-box.quantum { border-left-color: #28a745; }
        #status-box.fallback { border-left-color: #ffc107; }
        #status-box.loading { border-left-color: #17a2b8; }

        /* æŒ‰é’®æ ·å¼ */
        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .btn-full {
            grid-column: 1 / -1;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: var(--primary-color);
            color: white;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
            background-color: #004494;
        }

        button.secondary {
            background-color: #6c757d;
        }
        
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* ç»“æœå±•ç¤ºåŒºåŸŸæ ·å¼ */
        .result-area {
            margin-top: 20px;
        }

        .lottery-result {
            background: white;
            border: 1px solid #eee;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            display: none; /* é»˜è®¤éšè— */
        }

        .lottery-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        /* å·ç çƒæ ·å¼ */
        .ball {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            border-radius: 50%;
            text-align: center;
            margin: 0 4px;
            font-weight: bold;
            color: white;
        }
        .ball.red { background-color: #e74c3c; }
        .ball.blue { background-color: #3498db; }
        .ball.yellow { background-color: #f39c12; color: white;}
        .divider { margin: 0 5px; color: #999; }

    </style>
</head>
<body>

<div class="container">
    <h1>âš›ï¸ é‡å­ä½“å½©ç”Ÿæˆå™¨</h1>
    <p class="subtitle">åŸºäº ANU å®æ—¶é‡å­çœŸç©ºæ¶¨è½æ•°æ®</p>

    <div id="status-box" class="loading">
        æ­£åœ¨åˆå§‹åŒ–é‡å­è¿æ¥...
    </div>

    <div class="btn-group">
        <button id="btn-dlt" disabled>ç”Ÿæˆè¶…çº§å¤§ä¹é€</button>
        <button id="btn-p3" disabled>ç”Ÿæˆæ’åˆ— 3</button>
        <button id="btn-p5" disabled>ç”Ÿæˆæ’åˆ— 5</button>
        <button id="btn-qxc" disabled>ç”Ÿæˆ 7 æ˜Ÿå½©</button>
        <button id="btn-refresh" class="secondary btn-full">ğŸ”„ é‡æ–°è·å–é‡å­ç§å­</button>
    </div>

    <div class="result-area">
        <div id="result-dlt" class="lottery-result">
            <div class="lottery-title">è¶…çº§å¤§ä¹é€</div>
            <div class="numbers"></div>
        </div>
        <div id="result-generic" class="lottery-result">
            <div class="lottery-title" id="generic-title">å½©ç¥¨ç»“æœ</div>
            <div class="numbers" id="generic-nums"></div>
        </div>
    </div>

</div>

<script>
    // ==========================================
    // 1. è‡ªå®šä¹‰å¯ç½®ç§å­çš„éšæœºæ•°ç”Ÿæˆå™¨ (PRNG)
    // ==========================================
    // JavaScript çš„ Math.random() æ— æ³•è®¾ç½®ç§å­ã€‚
    // æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç®€å•é«˜æ•ˆçš„ç®—æ³• "mulberry32" æ¥å®ç°åŸºäºç§å­çš„éšæœºã€‚
    let seedState = 0;

    function initializeSeed(seedValue) {
        seedState = seedValue >>> 0; // ç¡®ä¿æ˜¯æ— ç¬¦å·32ä½æ•´æ•°
    }

    // è¿”å›ä¸€ä¸ª [0, 1) ä¹‹é—´çš„æµ®ç‚¹æ•°ï¼Œç±»ä¼¼äº Math.random()
    function nextRandom() {
        let t = seedState += 0x6D2B79F5;
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
    }

    // è¾…åŠ©å‡½æ•°ï¼šç”ŸæˆæŒ‡å®šèŒƒå›´å†…çš„éšæœºæ•´æ•° [min, max]
    function getRandomInt(min, max) {
        return Math.floor(nextRandom() * (max - min + 1)) + min;
    }

    // ==========================================
    // 2. æ ¸å¿ƒé€»è¾‘ï¼šè·å–çœŸéšæœºç§å­ & æ›´æ–° UI
    // ==========================================
    const statusBox = document.getElementById('status-box');
    const buttons = document.querySelectorAll('.btn-group button:not(.secondary)');
    const refreshBtn = document.getElementById('btn-refresh');

    function updateStatus(message, type) {
        statusBox.textContent = message;
        statusBox.className = type; // loading, quantum, fallback
        // ç§å­å°±ç»ªåå¯ç”¨æŒ‰é’®
        buttons.forEach(btn => btn.disabled = (type === 'loading'));
        refreshBtn.disabled = (type === 'loading');
    }

    async function fetchQuantumSeed() {
        updateStatus("æ­£åœ¨è¿æ¥æ¾³å¤§åˆ©äºšå›½ç«‹å¤§å­¦(ANU)é‡å­æœåŠ¡å™¨...", "loading");
        
        // è¯·æ±‚ä¸€ä¸ª 32ä½çš„åå…­è¿›åˆ¶æ•°ä½œä¸ºç§å­
        const url = "https://qrng.anu.edu.au/API/jsonI.php?length=1&type=hex16&size=4";

        try {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 8000); // 8ç§’è¶…æ—¶

            const response = await fetch(url, { signal: controller.signal });
            clearTimeout(timeoutId);

            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();

            if (data.success && data.data && data.data.length > 0) {
                const hexSeed = data.data[0];
                // å°†åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ç§å­
                const numericSeed = parseInt(hexSeed, 16);
                initializeSeed(numericSeed);
                updateStatus(`âœ… é‡å­ç§å­å·²å°±ç»ªã€‚æ¥æº: ANUçœŸç©ºæ¶¨è½\nSeedHash: 0x${hexSeed.substring(0, 10)}`, "quantum");
            } else {
                throw new Error("API è¿”å›æ•°æ®æ ¼å¼é”™è¯¯");
            }
        } catch (error) {
            console.warn("é‡å­APIè¿æ¥å¤±è´¥ï¼Œåˆ‡æ¢è‡³æœ¬åœ°å®‰å…¨éšæœºæº:", error);
            // å›é€€æ–¹æ¡ˆï¼šä½¿ç”¨æµè§ˆå™¨å†…ç½®çš„å¯†ç å­¦å®‰å…¨éšæœºæ•°ç”Ÿæˆå™¨
            const fallbackSeed = new Uint32Array(1);
            window.crypto.getRandomValues(fallbackSeed);
            initializeSeed(fallbackSeed[0]);
            updateStatus(`âš ï¸ æ— æ³•è¿æ¥é‡å­æœåŠ¡å™¨ (åŸå› : ${error.message})ã€‚\nå·²åˆ‡æ¢ä¸ºæœ¬åœ°æµè§ˆå™¨å®‰å…¨éšæœºæº (Web Crypto API)ã€‚`, "fallback");
        }
    }

    // ==========================================
    // 3. å½©ç¥¨ç”Ÿæˆé€»è¾‘
    // ==========================================

    // è¾…åŠ©ï¼šæŠ½å–ä¸é‡å¤çš„æ•°å­—å¹¶æ’åº (ç”¨äºå¤§ä¹é€å‰åŒº/ååŒº)
    function drawUniqueSorted(count, min, max) {
        const nums = new Set();
        while (nums.size < count) {
            nums.add(getRandomInt(min, max));
        }
        return Array.from(nums).sort((a, b) => a - b);
    }

    // è¾…åŠ©ï¼šæŠ½å–å¯é‡å¤çš„æ•°å­— (ç”¨äºæ’åˆ—3/5, ä¸ƒæ˜Ÿå½©)
    function drawRepeatable(count, min, max) {
        const nums = [];
        for (let i = 0; i < count; i++) {
            nums.push(getRandomInt(min, max));
        }
        return nums;
    }

    // è¾…åŠ©ï¼šæ ¼å¼åŒ–æ•°å­—ä¸ºä¸¤ä½æ•° (å¦‚ 5 -> "05")
    const fmt = n => n.toString().padStart(2, '0');

    // ç”Ÿæˆå¹¶æ˜¾ç¤ºå¤§ä¹é€
    function generateDLT() {
        const front = drawUniqueSorted(5, 1, 35).map(n => `<span class="ball red">${fmt(n)}</span>`).join('');
        const back = drawUniqueSorted(2, 1, 12).map(n => `<span class="ball blue">${fmt(n)}</span>`).join('');
        
        document.querySelector('#result-dlt .numbers').innerHTML = `${front} <span class="divider">|</span> ${back}`;
        document.getElementById('result-dlt').style.display = 'block';
        document.getElementById('result-generic').style.display = 'none';
    }

    // ç”Ÿæˆå¹¶æ˜¾ç¤ºé€šç”¨æ•°å­—å‹ (æ’åˆ—3/5, ä¸ƒæ˜Ÿå½©)
    function generateNumericLottery(title, count, ballClass) {
        const nums = drawRepeatable(count, 0, 9)
            .map(n => `<span class="ball ${ballClass}">${n}</span>`)
            .join('');
        
        document.getElementById('generic-title').textContent = title;
        document.getElementById('generic-nums').innerHTML = nums;
        document.getElementById('result-generic').style.display = 'block';
        document.getElementById('result-dlt').style.display = 'none';
    }

    // ==========================================
    // 4. äº‹ä»¶ç›‘å¬ä¸åˆå§‹åŒ–
    // ==========================================
    document.getElementById('btn-refresh').addEventListener('click', fetchQuantumSeed);
    
    document.getElementById('btn-dlt').addEventListener('click', generateDLT);
    
    document.getElementById('btn-p3').addEventListener('click', () => {
        generateNumericLottery('æ’åˆ— 3 (P3)', 3, 'yellow');
    });
    
    document.getElementById('btn-p5').addEventListener('click', () => {
        generateNumericLottery('æ’åˆ— 5 (P5)', 5, 'yellow');
    });

    document.getElementById('btn-qxc').addEventListener('click', () => {
        // ä¸ƒæ˜Ÿå½©å‰6ä½æ˜¯åŸºæœ¬å·ç ï¼Œæœ€å1ä½æ˜¯ç‰¹åˆ«å·ç ï¼Œè¿™é‡Œç®€åŒ–ç»Ÿä¸€æ˜¾ç¤ºï¼Œä¹Ÿå¯åˆ†å¼€
        generateNumericLottery('7 æ˜Ÿå½© (QXC)', 7, 'blue');
    });

    // é¡µé¢åŠ è½½å®Œæˆåç«‹å³è·å–ç§å­
    fetchQuantumSeed();

</script>
</body>
</html>